{% extends "base.html" %}
{% block title %}Home · Chat My History{% endblock %}
{% block content %}
  <section class="mt-8 grid gap-6">
    <h1 class="text-3xl font-bold">Welcome</h1>
    <p class="text-lg">Create a rich, shareable life history through guided conversations.</p>
    <div class="grid sm:grid-cols-2 gap-4">
      <a href="/interview/" class="block p-6 rounded border text-center text-xl bg-green-300 border-green-500 text-black hover:bg-yellow-200 happy-pulse">Start an Interview</a>
    </div>

    {% if current_user.is_authenticated %}
    <section class="grid gap-4">
      <div class="bg-white border rounded p-4">
        <h2 class="text-xl font-semibold mb-2">Your progress</h2>
        <ul class="list-disc ml-6 space-y-1">
          <li><strong>{{ total_interviews or 0 }}</strong> topics created{% if interviews %} — most recent shown below{% endif %}.</li>
          <li><strong>{{ persona_count or 0 }}</strong> personas available{% if default_persona %} — default: <em>{{ default_persona.name }}</em>{% endif %}.</li>
          <li><strong>{{ summaries_count or 0 }}</strong> summary documents generated.</li>
        </ul>
        {% if interviews and interviews|length > 0 %}
        <div class="mt-3">
          <h3 class="font-semibold mb-1">Recent topics</h3>
          <ul class="divide-y">
            {% for i in interviews %}
              <li class="py-2 flex items-center justify-between">
                <a class="underline" href="/interview/{{ i.id }}">{{ i.title }}</a>
                <span class="text-sm text-gray-600">{{ (msg_counts[i.id] if msg_counts and i.id in msg_counts else 0) }} messages{% if summary_ids and i.id in summary_ids %} • has summary{% endif %}</span>
              </li>
            {% endfor %}
          </ul>
          <div class="mt-2"><a href="/interview/" class="underline">View all topics</a></div>
        </div>
        {% endif %}
      </div>

      <div class="bg-white border rounded p-4">
        <h2 class="text-xl font-semibold mb-2">How <b>Chat My History</b> works</h2>
        <ul class="list-disc ml-6 space-y-2">
          <li><strong>Interviews</strong>: Create a topic and chat about it. You can pivot within a topic or switch to a new one at any time with the built‑in controls.</li>
          <li><strong>Personas & styles</strong>: Choose an interviewer persona and mix communication styles on the <a class="underline" href="/styles">Styles</a> page to change tone and approach.</li>
          <li><strong>Summary documents</strong>: From any interview, generate a structured summary and export it as Markdown or PDF for safekeeping and sharing.</li>
        </ul>
      </div>
    </section>
    {% endif %}
  </section>
  <style>
    /* Gentle, happy pulse that pauses most of the time and briefly warms to yellow */
    @keyframes cmhHappyPulse {
      0%, 72% { background-color: #86efac; } /* green-300 */
      78% { background-color: #fde68a; } /* yellow-300 */
      84% { background-color: #fcd34d; } /* amber-300 */
      100% { background-color: #86efac; }
    }
    .happy-pulse {
      animation: cmhHappyPulse 6s ease-in-out infinite;
    }
  </style>
  <footer class="mt-8 text-center text-sm text-gray-500">copyright {{ current_year or  now().year if now else '' }} S E Sampson</footer>
{% endblock %}
